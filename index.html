<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Rivus CEP : Complex event processing in Erlang" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Rivus CEP</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/vascokk/rivus_cep">View on GitHub</a>

          <h1 id="project_title">Rivus CEP</h1>
          <h2 id="project_tagline">Complex event processing in Erlang</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/vascokk/rivus_cep/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/vascokk/rivus_cep/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><a href="https://travis-ci.org/vascokk/rivus_cep"><img src="https://travis-ci.org/vascokk/rivus_cep.png" alt="Build Status"></a></p>

<h1>
<a name="rivus-cep" class="anchor" href="#rivus-cep"><span class="octicon octicon-link"></span></a>Rivus CEP</h1>

<p>Rivus CEP is an Erlang library for complex event processing. It uses a declarative SQL-like DSL for processing the events.</p>

<p>With Rivus you can do things like:</p>

<pre><code>select 
    ev1.eventparam1, ev2.eventparam2, sum(ev2.eventparam3) 
from 
    event1 as ev1, event2 as ev2
where 
    ev1.eventparam2 = ev2.eventparam2
within 60 seconds
</code></pre>

<p>or 'select' events from pattern:</p>

<pre><code>select 
    ev1.eventparam1, ev2.eventparam2, ev2.eventparam3, ev2.eventparam4
from 
    event1 as ev1 -&gt; event2 as ev2
where
    ev1.eventparam2 = ev2.eventparam2
within 60 seconds
</code></pre>

<p>In the second query, the result will be generated only in case when event2 stricltly follows event1, within a 60 seconds window.</p>

<p>Here is how to use it:</p>

<div class="highlight highlight-erlang"><pre><span class="nn">application</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">rivus_cep</span><span class="p">)</span>

<span class="nv">QueryStr</span> <span class="o">=</span> <span class="s">"define correlation2 as</span>
<span class="s">                  select ev1.eventparam1, ev2.eventparam2, sum(ev2.eventparam3) </span>
<span class="s">                  from event1 as ev1, event2 as ev2</span>
<span class="s">                   where ev1.eventparam2 = ev2.eventparam2</span>
<span class="s">                    within 60 seconds; "</span>

<span class="nv">Producer</span> <span class="o">=</span> <span class="n">event_producer_1</span><span class="p">,</span>
<span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">SubscriberPid</span><span class="p">}</span> <span class="o">=</span> <span class="nn">result_subscriber</span><span class="p">:</span><span class="nf">start_link</span><span class="p">(),</span> 

<span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">QueryPid</span><span class="p">}</span> <span class="o">=</span> <span class="nn">rivus_cep</span><span class="p">:</span><span class="nf">load_query</span><span class="p">(</span><span class="nv">QueryStr</span><span class="p">,</span> <span class="p">[</span><span class="nv">Producer</span><span class="p">],</span> <span class="p">[</span><span class="nv">SubscriberPid</span><span class="p">],</span> <span class="p">[{</span><span class="n">shared_streams</span><span class="p">,</span> <span class="n">true</span><span class="p">}]),</span>

<span class="c">%% create some evetnts</span>
<span class="nv">Event1</span> <span class="o">=</span> <span class="p">{</span><span class="n">event1</span><span class="p">,</span> <span class="n">gr1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">10</span><span class="p">},</span> 
<span class="nv">Event2</span> <span class="o">=</span> <span class="p">{</span><span class="n">event2</span><span class="p">,</span> <span class="n">gr2</span><span class="p">,</span><span class="n">bbb</span><span class="p">,</span><span class="mi">20</span><span class="p">},</span>

<span class="c">%% send the events</span>
<span class="nn">rivus_cep</span><span class="p">:</span><span class="nf">notify</span><span class="p">(</span><span class="nv">Producer</span><span class="p">,</span> <span class="nv">Event1</span><span class="p">),</span>
<span class="nn">rivus_cep</span><span class="p">:</span><span class="nf">notify</span><span class="p">(</span><span class="nv">Producer</span><span class="p">,</span> <span class="nv">Event2</span><span class="p">).</span>

<span class="c">%% or if you don't care about the producers</span>
<span class="nn">rivus_cep</span><span class="p">:</span><span class="nf">notify</span><span class="p">(</span><span class="nv">Event1</span><span class="p">),</span>
<span class="nn">rivus_cep</span><span class="p">:</span><span class="nf">notify</span><span class="p">(</span><span class="nv">Event2</span><span class="p">).</span>

</pre></div>

<p>The query is started with <code>rivus_cep:load_query/4</code>. It takes as arguments: query string, list of event producers, list of query result subscribers and options as a proplist.</p>

<p>Each query worker will register itself to the  <a href="https://github.com/uwiger/gproc">gproc</a> process registry, for the events listed in the "from" clause.</p>

<p>If the events are sent via <code>rivus_cep:notify/1</code>, the event will be received by any query subscribed for this event type. With <code>notify/2</code> - only the queries subscribed to the particular Producer will receive the event.</p>

<p>For each query there must be at least one Subscriber to receive the query results.</p>

<p>See <code>tests/rivus_cep_tests.erl</code> for more usage examples. </p>

<p>Internally, the events are stored in an ETS-based sliding window. DSL statments are translated to Erlang "match specifications" and QLC queries.</p>

<p>For each event type there must be a module implementing the <code>event_behavior</code> with the same name used in the "from" clause. The important function that needs to be implemented is - <code>get_param_by_name(Event, ParamName)</code>. </p>

<p>For memory efficiency, <code>{shared_streams, true}</code> can be provided in the options list. In this case, the query will work with a shared event sliding window. The window's size will be equal of the maximum "within" clause of all sharing queries.
Queries based on event pattern use only non-shared windows.</p>

<p>Only "strict" event patterns are supported at the moment. This means, for a pattern "event1 -&gt; event2", if some other event is received in between (event1-&gt;other event-&gt;event2), the query won't generate any result.</p>

<p>See some DSL examples in <code>test/rivus_cep_parser_tests.erl</code>.</p>

<h3>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h3>

<ul>
<li><a href="https://github.com/uwiger/gproc">gproc</a></li>
<li><a href="https://github.com/boundary/folsom">folsom</a></li>
<li><a href="https://github.com/basho/lager">lager</a></li>
</ul><h3>
<a name="current-limitations" class="anchor" href="#current-limitations"><span class="octicon octicon-link"></span></a>Current limitations</h3>

<p>The project is in its infancy and there is a number of limitations/TODOs:</p>

<ul>
<li>more aggregation functions are yet to be implemented;</li>
<li>using event aliases is mandatory;</li>
<li>only sliding windows are supported (no 'batch' windows);</li>
<li>no benchmarks at all;</li>
<li>extensive testing needed.</li>
</ul><h3>
<a name="contributions" class="anchor" href="#contributions"><span class="octicon octicon-link"></span></a>Contributions</h3>

<p>Contributions and suggestions are most appreciated!</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Rivus CEP maintained by <a href="https://github.com/vascokk">vascokk</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
